
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BMW 360° Rotator v2 — Seshat</title>

<style>
  :root{--bg:#0b0f14;--ui:#0f1720;--accent:#0db0ff;--muted:#9aa4b2}
  body{margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:var(--bg);color:#fff;display:flex;align-items:flex-start;justify-content:center;padding:20px}
  .wrap{width:100%;max-width:1100px}
  h1{font-size:20px;margin:0 0 12px 0}
  .panel{display:flex;gap:18px;align-items:flex-start}
  .viewer-wrap{background:linear-gradient(180deg,#0b1220 0%, #071018 100%);padding:18px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.6)}
  #viewer{width:720px;height:420px;position:relative;overflow:hidden;border-radius:10px;cursor:grab;touch-action:none;background:#000}
  #viewer img{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);max-width:none;max-height:none;user-select:none;-webkit-user-drag:none}
  #viewer .hotspot{position:absolute;width:18px;height:18px;border-radius:50%;background:rgba(255,255,255,0.9);border:2px solid var(--accent);box-shadow:0 6px 14px rgba(0,0,0,.5);cursor:pointer;transform:translate(-50%,-50%);display:flex;align-items:center;justify-content:center;font-size:11px;color:#000}
  .controls{width:320px;padding:14px;background:rgba(255,255,255,0.03);border-radius:10px}
  .row{display:flex;gap:8px;align-items:center;margin-bottom:10px}
  .btn{background:var(--accent);color:#042;border:none;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600}
  .small{font-size:13px;color:var(--muted)}
  .slider{width:100%}
  select, input[type=range]{width:100%}
  .color-btn{padding:8px 10px;border-radius:8px;border:none;cursor:pointer}
  .fps{font-weight:700;margin-left:auto;color:var(--muted)}
  .tip{font-size:13px;color:var(--muted);margin-top:10px}
  .popup{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#fff;color:#111;padding:14px;border-radius:10px;display:none;z-index:9999;min-width:240px;box-shadow:0 20px 60px rgba(0,0,0,.6)}
  .popup.open{display:block}
  .close-x{float:right;cursor:pointer;background:#eee;padding:2px 6px;border-radius:6px}
  /* responsive */
  @media(max-width:960px){
    .panel{flex-direction:column}
    #viewer{width:92vw;height:56vw}
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>BMW 360° Rotator — v2 (Auto-rotate, Zoom, Color, Hotspots)</h1>
  <div class="panel">
    <div class="viewer-wrap">
      <div id="viewer" title="Drag to rotate, wheel to zoom"></div>
      <div class="tip">Tip: Drag left/right to rotate • Wheel to zoom • Tap hotspots for info</div>
    </div>

    <div class="controls">
      <div class="row"><button class="btn" id="playBtn">Auto Rotate: OFF</button><div class="fps small" id="fpsLabel">FPS: 0</div></div>

      <div class="row"><label class="small">Speed</label><input id="speedRange" type="range" min="1" max="60" value="18" class="slider"></div>

      <div class="row"><label class="small">Animation Smoothness (frames)</label><input id="smoothRange" type="range" min="1" max="6" value="3"></div>

      <div class="row"><label class="small">Auto-spin Direction</label>
        <select id="dirSelect">
          <option value="1">Clockwise</option>
          <option value="-1">Anti-clockwise</option>
        </select>
      </div>

      <div class="row"><label class="small">Color</label>
        <div style="display:flex;gap:8px">
          <button class="color-btn" data-h="0" style="background:#ffffff">White</button>
          <button class="color-btn" data-h="200" style="background:#1e90ff">Blue</button>
          <button class="color-btn" data-h="0" style="background:#000000;color:#fff">Black</button>
          <button class="color-btn" data-h="320" style="background:#ff3b7f">Red</button>
        </div>
      </div>

      <div class="row"><label class="small">Auto-rotate FPS cap</label><input id="fpsCap" type="range" min="5" max="120" value="60" class="slider"><div class="small" id="fpsCapLabel">60</div></div>

      <div style="margin-top:12px" class="small">Frames used: 36 (demo). Replace frames[] with your high-quality 36 images for best result.</div>
    </div>
  </div>
</div>

<!-- Info popup -->
<div id="popup" class="popup"><span class="close-x" id="closePopup">✕</span><div id="popupContent"></div></div>

<script>
/* -----------------------------
  Frames (36 frames total)
  I used 12 unique Pixabay images repeated 3 times to get 36 frames.
  Replace with your own 36-frame URLs for real smooth 360.
------------------------------*/
const baseFrames = [
  "https://cdn.pixabay.com/photo/2017/01/06/19/15/bmw-1957031_1280.jpg",
  "https://cdn.pixabay.com/photo/2016/11/22/19/25/bmw-1854737_1280.jpg",
  "https://cdn.pixabay.com/photo/2018/03/01/09/33/bmw-3189930_1280.jpg",
  "https://cdn.pixabay.com/photo/2020/05/09/09/37/bmw-5149407_1280.jpg",
  "https://cdn.pixabay.com/photo/2017/03/27/14/56/bmw-2173982_1280.jpg",
  "https://cdn.pixabay.com/photo/2019/01/15/21/33/bmw-3931460_1280.jpg",
  "https://cdn.pixabay.com/photo/2017/03/27/14/55/bmw-2173981_1280.jpg",
  "https://cdn.pixabay.com/photo/2017/03/27/14/56/bmw-2173984_1280.jpg",
  "https://cdn.pixabay.com/photo/2016/11/21/14/50/auto-1844507_1280.jpg",
  "https://cdn.pixabay.com/photo/2017/01/06/19/15/bmw-1957030_1280.jpg",
  "https://cdn.pixabay.com/photo/2020/05/09/10/01/bmw-5149412_1280.jpg",
  "https://cdn.pixabay.com/photo/2017/03/27/14/56/bmw-2173983_1280.jpg"
];
// repeat to make 36
let frames = [];
for(let i=0;i<3;i++) frames = frames.concat(baseFrames);

// Preload images
const preloaded = [];
frames.forEach((src,i)=>{ const im=new Image(); im.src=src; preloaded.push(im); });

const viewer = document.getElementById('viewer');
let imgs = []; // DOM img elements
let current = 0;
let total = frames.length; // 36

// Create img elements
for(let i=0;i<total;i++){
  const img = document.createElement('img');
  img.src = frames[i];
  img.style.opacity = '0';
  img.dataset.index = i;
  viewer.appendChild(img);
  imgs.push(img);
}
// set first visible
imgs[0].style.opacity = '1';
imgs[0].classList.add('active');
imgs.forEach((im,i)=>{
  im.style.transition = 'opacity .08s linear';
});

/* ---------- Hotspots (percentage coordinates) ---------- */
/* positions are relative to viewer size (left%, top%) */
const hotspots = [
  {id:'door', x:68, y:60, title:'Passenger Door', text:'Soft-close door, keyless entry, high-grade materials.'},
  {id:'bonnet', x:45, y:25, title:'Bonnet / Hood', text:'3.0L twin-turbo engine, aluminum construction.'}
];
hotspots.forEach(h=>{
  const el = document.createElement('div');
  el.className='hotspot';
  el.innerText='i';
  el.style.left = h.x+'%';
  el.style.top = h.y+'%';
  el.title = h.title;
  el.dataset.info = h.text;
  viewer.appendChild(el);
  el.addEventListener('click', (ev)=>{
    showPopup(`<b>${h.title}</b><p style="margin:8px 0 0">${h.text}</p>`);
  });
});

/* ---------- Popup ---------- */
const popup = document.getElementById('popup');
const popupContent = document.getElementById('popupContent');
document.getElementById('closePopup').addEventListener('click', ()=> popup.classList.remove('open'));
function showPopup(html){
  popupContent.innerHTML = html;
  popup.classList.add('open');
}

/* ---------- Interaction: drag rotate, touch ---------- */
let isDown=false, startX=0, vel=0;
viewer.addEventListener('pointerdown', (e)=>{
  isDown=true; startX = e.clientX; viewer.style.cursor='grabbing'; e.preventDefault();
});
window.addEventListener('pointerup', (e)=>{ isDown=false; viewer.style.cursor='grab'; });
window.addEventListener('pointermove', (e)=>{
  if(!isDown) return;
  const dx = e.clientX - startX;
  if(Math.abs(dx) > 4){
    // change frame based on dx
    const step = Math.sign(dx) * Math.max(1, Math.floor(Math.abs(dx)/6));
    current = (current - step + total) % total; // reverse sign for natural feel
    showFrame(current);
    startX = e.clientX;
  }
});

/* ---------- Wheel zoom + pan ---------- */
let scale = 1, translateX = 0, translateY = 0, isPanning=false, panStart={x:0,y:0};
viewer.addEventListener('wheel', (e)=>{
  e.preventDefault();
  const delta = e.deltaY;
  scale = Math.max(0.6, Math.min(2.4, scale - delta*0.0015));
  applyTransform();
});
viewer.addEventListener('dblclick', ()=>{ scale = 1; translateX=0; translateY=0; applyTransform(); });

viewer.addEventListener('pointerdown', (e)=>{
  if(scale > 1){ isPanning=true; panStart={x:e.clientX - translateX, y:e.clientY - translateY}; }
});
window.addEventListener('pointerup', ()=> isPanning=false);
window.addEventListener('pointermove', (e)=>{
  if(isPanning){
    translateX = e.clientX - panStart.x;
    translateY = e.clientY - panStart.y;
    applyTransform();
  }
});
function applyTransform(){
  // apply CSS transform to all imgs to keep zoom synchronized
  imgs.forEach(im=>{
    im.style.transform = `translate(-50%,-50%) scale(${scale}) translate(${translateX}px, ${translateY}px)`;
  });
}

/* ---------- Show frame helper ---------- */
function showFrame(idx){
  idx = (idx + total) % total;
  // fade style for smoothness
  imgs.forEach((im,i)=> {
    if(i===idx) { im.style.opacity='1'; } else im.style.opacity='0'; 
  });
  current = idx;
}

/* ---------- Auto-rotate logic (high-FPS) ---------- */
let auto = false;
let dir = 1;
let speed = 18; // frames per second target
let smooth = 3; // interpolation multiplier
let fpsCap = 60;

const playBtn = document.getElementById('playBtn');
const speedRange = document.getElementById('speedRange');
const smoothRange = document.getElementById('smoothRange');
const dirSelect = document.getElementById('dirSelect');
const fpsLabel = document.getElementById('fpsLabel');
const fpsCapEl = document.getElementById('fpsCap');
const fpsCapLabel = document.getElementById('fpsCapLabel');

playBtn.addEventListener('click', ()=>{
  auto = !auto;
  playBtn.innerText = 'Auto Rotate: ' + (auto? 'ON':'OFF');
  if(auto) lastTs = performance.now();
});

speedRange.addEventListener('input', ()=> speed = parseInt(speedRange.value));
smoothRange.addEventListener('input', ()=> smooth = parseInt(smoothRange.value));
dirSelect.addEventListener('change', ()=> dir = parseInt(dirSelect.value));
fpsCapEl.addEventListener('input', ()=> { fpsCapLabel.innerText = fpsCapEl.value; fpsCap = parseInt(fpsCapEl.value); });

let lastTs = performance.now();
let acc = 0;

function rafLoop(ts){
  window.requestAnimationFrame(rafLoop);
  const dt = Math.min(1000, ts - lastTs);
  lastTs = ts;
  if(auto){
    // accumulate based on target speed
    acc += (dt/1000) * speed * dir;
    // show frame when acc surpasses 1
    const frameStep = Math.floor(acc);
    if(frameStep !== 0){
      // move smooth*frameStep frames to make it look smooth
      const step = frameStep * Math.max(1, smooth);
      current = (current + step + total) % total;
      showFrame(current);
      acc -= frameStep;
    }
  }
  // show FPS approx based on dt (capped)
  const fpsNow = Math.round(1000 / (dt || 1));
  fpsLabel.innerText = 'FPS: ' + Math.min(fpsNow, fpsCap);
}
window.requestAnimationFrame(rafLoop);

/* ---------- Color changer (css filters) ---------- */
document.querySelectorAll('.color-btn').forEach(b=>{
  b.addEventListener('click', ()=>{
    const hue = parseInt(b.dataset.h);
    let filter = '';
    if(hue === 0 && b.innerText.trim()!=='Black'){ filter = 'saturate(0.03) brightness(1.15)'; } // white-ish
    else if(b.innerText.trim()==='Black'){ filter = 'saturate(0.2) brightness(.22) contrast(1.2)'; }
    else { filter = `hue-rotate(${hue}deg) saturate(1.2) brightness(1)`;}
    imgs.forEach(im=> im.style.filter = filter);
  });
});

/* ---------- init UI values ---------- */
speedRange.value = speed;
smoothRange.value = smooth;
fpsCapLabel.innerText = fpsCap;
fpsLabel.innerText = 'FPS: 0';

/* ---------- Touch support: basic pinch zoom ---------- */
let pointers = {};
let lastDist = null;
viewer.addEventListener('pointerdown', (e)=> { pointers[e.pointerId] = e; });
viewer.addEventListener('pointerup', (e)=> { delete pointers[e.pointerId]; lastDist = null; });
viewer.addEventListener('pointercancel', (e)=> { delete pointers[e.pointerId]; lastDist = null; });
viewer.addEventListener('pointermove', (e)=> {
  if(Object.keys(pointers).length >= 2){
    // compute pinch
    pointers[e.pointerId] = e;
    const ps = Object.values(pointers);
    if(ps.length >= 2){
      const dx = ps[0].clientX - ps[1].clientX;
      const dy = ps[0].clientY - ps[1].clientY;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if(lastDist != null){
        const delta = dist - lastDist;
        scale = Math.max(0.6, Math.min(2.4, scale + delta * 0.005));
        applyTransform();
      }
      lastDist = dist;
    }
  } else {
    pointers[e.pointerId] = e;
  }
});

/* ---------- helper: replace frames with user images (optional) ---------- */
function setFrames(urls){
  // clears existing imgs and rebuilds
  imgs.forEach(im=> im.remove());
  imgs = [];
  frames = urls.slice(0);
  total = frames.length;
  frames.forEach((src,i)=>{
    const im = document.createElement('img'); im.src=src; im.dataset.index=i; im.style.opacity='0'; im.style.transition='opacity .05s linear';
    viewer.appendChild(im); imgs.push(im);
  });
  imgs[0].style.opacity='1'; current=0;
}

/* ---------- replace demo frames example (commented) ----------
setFrames(['frame1.jpg','frame2.jpg',...]); 
----------------------------------- */

</script>
</body>
</html>
